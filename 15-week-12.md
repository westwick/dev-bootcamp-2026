# Week 12 â€” Deployment & Production

*Month 3: The Modern Web*

---

## Goals

- Understand development vs production
- Learn deployment options
- Deploy your full-stack application
- Configure production environment
- Complete the final project

---

## Part 1: Development vs Production

### What to Learn

- What changes in production?
- What are production builds?
- What is minification?
- Security considerations

### Key Differences

| Aspect | Development | Production |
|--------|-------------|------------|
| Error messages | Detailed | Generic |
| Source maps | Yes | No (usually) |
| Code size | Large | Minified |
| Logging | Verbose | Minimal |
| Database | Local | Remote |
| URL | localhost | Real domain |

### Environment Variables in Production

**.env (development)**
```
NODE_ENV=development
DATABASE_URL=postgresql://localhost/tasktracker
JWT_SECRET=dev-secret-change-in-prod
FRONTEND_URL=http://localhost:5173
```

**Production (set in hosting platform)**
```
NODE_ENV=production
DATABASE_URL=postgresql://user:pass@host/db
JWT_SECRET=super-long-random-string-here
FRONTEND_URL=https://yourapp.com
```

### ðŸ¤– AI Learning Prompts

- "What's the difference between development and production?"
- "What does npm run build do for React?"
- "What environment variables do I need for production?"
- "What is code minification?"

---

## Part 2: Deployment Options

### Frontend Hosting (Static)

For React apps after `npm run build`:

| Platform | Best For | Free Tier |
|----------|----------|-----------|
| Vercel | React/Next.js | Yes |
| Netlify | Static sites | Yes |
| GitHub Pages | Simple sites | Yes |
| Cloudflare Pages | Global CDN | Yes |

### Backend Hosting (Server)

For Express/Node.js:

| Platform | Best For | Free Tier |
|----------|----------|-----------|
| Railway | Simple deploys | Limited |
| Render | Full-stack | Yes |
| Fly.io | Docker apps | Yes |
| DigitalOcean | More control | No |

### Database Hosting

| Platform | Database | Free Tier |
|----------|----------|-----------|
| Neon | PostgreSQL | Yes |
| Supabase | PostgreSQL | Yes |
| Railway | PostgreSQL | Limited |
| PlanetScale | MySQL | Yes |

---

## Part 3: Deploy Frontend to Vercel

### Step 1: Prepare for Production

Update API URL to use environment variable:

```javascript
// src/config.js
export const API_URL = import.meta.env.VITE_API_URL || 'http://localhost:3000';
```

Update fetch calls:
```javascript
import { API_URL } from '../config';

const response = await fetch(`${API_URL}/projects`);
```

### Step 2: Deploy to Vercel

1. Push code to GitHub
2. Go to vercel.com
3. Click "New Project"
4. Import your GitHub repo
5. Configure:
   - Framework: Vite
   - Build Command: `npm run build`
   - Output Directory: `dist`
6. Add environment variable:
   - `VITE_API_URL` = `https://your-backend-url.com`
7. Deploy!

### Automatic Deploys

Vercel automatically deploys when you push to main.

### ðŸ¤– AI Learning Prompts

- "How do I deploy a React Vite app to Vercel?"
- "How do I use environment variables in Vite?"
- "How do I set up automatic deploys from GitHub?"

---

## Part 4: Deploy Backend to Railway

### Step 1: Prepare for Production

**package.json**
```json
{
  "scripts": {
    "start": "node src/server.js",
    "dev": "node --watch src/server.js"
  },
  "engines": {
    "node": "20.x"
  }
}
```

**src/server.js**
```javascript
const PORT = process.env.PORT || 3000;

app.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});
```

### Step 2: Update CORS

```javascript
const cors = require('cors');

app.use(cors({
  origin: process.env.FRONTEND_URL || 'http://localhost:5173',
  credentials: true
}));
```

### Step 3: Deploy to Railway

1. Go to railway.app
2. Click "New Project"
3. Select "Deploy from GitHub repo"
4. Choose your backend repo
5. Add PostgreSQL:
   - Click "New" â†’ "Database" â†’ "PostgreSQL"
6. Add environment variables:
   - `JWT_SECRET` = (generate a random string)
   - `FRONTEND_URL` = (your Vercel URL)
   - `DATABASE_URL` is auto-set by Railway
7. Deploy!

### Step 4: Run Migrations

In Railway dashboard:
1. Go to your service
2. Click "Settings" â†’ "Deploy" 
3. Add Start Command: `npx prisma migrate deploy && npm start`

Or run manually:
```bash
# Railway CLI
railway run npx prisma migrate deploy
```

### ðŸ¤– AI Learning Prompts

- "How do I deploy an Express API to Railway?"
- "How do I add a PostgreSQL database on Railway?"
- "How do I run Prisma migrations in production?"
- "How do I configure CORS for production?"

---

## Part 5: Production Checklist

### Security

- [ ] Strong JWT_SECRET (32+ random characters)
- [ ] HTTPS only (handled by hosting)
- [ ] CORS configured for your domain only
- [ ] No sensitive data in console.log
- [ ] Rate limiting (consider adding)
- [ ] Helmet.js for security headers

### Environment

- [ ] NODE_ENV=production
- [ ] All env vars set in hosting platform
- [ ] .env not committed to git
- [ ] Database connection string correct

### Performance

- [ ] Frontend build is minified (`npm run build`)
- [ ] Database has indexes (if needed)
- [ ] Connection pooling enabled

### Monitoring

- [ ] Check deployment logs
- [ ] Test all endpoints work
- [ ] Test login/register flow
- [ ] Test on mobile

---

## Part 6: Adding Security Headers

### Helmet.js

```bash
npm install helmet
```

```javascript
const helmet = require('helmet');

// Add security headers
app.use(helmet());
```

### Rate Limiting

```bash
npm install express-rate-limit
```

```javascript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // limit each IP to 100 requests per windowMs
  message: { error: 'Too many requests' }
});

app.use('/auth', limiter);
```

---

## Part 7: Debugging Deployment Issues

### Common Problems

**Backend won't start:**
- Check logs in Railway dashboard
- Verify all env vars are set
- Make sure PORT is not hardcoded

**Database connection fails:**
- Verify DATABASE_URL is correct
- Check if database is provisioned
- Run migrations

**CORS errors:**
- Check FRONTEND_URL env var
- Make sure it matches exactly (no trailing slash)
- Verify CORS middleware is before routes

**Frontend can't reach backend:**
- Check VITE_API_URL is set
- Verify backend is running
- Check browser console for errors

### ðŸ¤– AI Debugging Prompts

- "My Railway deploy fails with [error], what's wrong?"
- "I'm getting CORS errors in production, how do I fix it?"
- "My Prisma migrations won't run in production"
- "How do I check logs on Railway?"

---

## ðŸ§© Month 3 Final Project

See full requirements in [Month 3 Project](16-month-3-project.md).

---

## âœ… Week 12 Milestone Checklist

- [ ] I understand dev vs production environments
- [ ] I can configure environment variables for production
- [ ] My frontend is deployed to Vercel
- [ ] My backend is deployed to Railway
- [ ] My database is hosted and connected
- [ ] CORS is configured correctly
- [ ] All features work in production
- [ ] I have a working, deployed full-stack application!

---

## Next Up

[Month 3 Final Project â†’](16-month-3-project.md)

[Graduation â†’](17-graduation.md)
